{% extends "website/base.html" %}

{% block titleblock %}
Respawn Sleeve
{% endblock %}

{% block content %}

<div class="row">
  <div class="col">
    <div class="card">
      <div class="card-body">
        <h1 class="card-title">Respawn Sleeve</h1>
        <p class="text-muted">Your previous sleeve has been archived. Select a new sleeve to decant into.</p>
        <hr />
        
        <form method="post" action="?">
          {% csrf_token %}
          
          <div class="form-section mb-4">
            {% for template in templates %}
            <div class="card mb-3 sleeve-option">
              <div class="card-body">
                <div class="form-check">
                  <input 
                    class="form-check-input" 
                    type="radio" 
                    name="sleeve_choice" 
                    id="template_{{ forloop.counter0 }}" 
                    value="template_{{ forloop.counter0 }}"
                    {% if forloop.first %}checked{% endif %}
                  >
                  <label class="form-check-label" for="template_{{ forloop.counter0 }}">
                    <h5>{{ template.name }} <small class="text-muted">({{ template.sex|title }})</small></h5>
                  </label>
                </div>
                <div class="ml-4 mt-2">
                  <div class="row">
                    <div class="col-md-3">
                      <strong>Grit:</strong> {{ template.grit }}
                    </div>
                    <div class="col-md-3">
                      <strong>Resonance:</strong> {{ template.resonance }}
                    </div>
                    <div class="col-md-3">
                      <strong>Intellect:</strong> {{ template.intellect }}
                    </div>
                    <div class="col-md-3">
                      <strong>Motorics:</strong> {{ template.motorics }}
                    </div>
                  </div>
                </div>
              </div>
            </div>
            {% endfor %}
            
            {% if old_character %}
            <div class="mt-4 mb-3 flash-clone-warning">
              <div class="text-center py-3">
                <h5 class="mb-1" style="color: #e6c547; font-weight: 700; text-transform: uppercase; letter-spacing: 0.1em;">âš  Flash Clone Option</h5>
                <small style="color: #999;">Create an identical clone of your previous sleeve</small>
                <div class="mt-2">
                  <small style="color: #e6c547;">
                    <strong>WARNING:</strong> Flash cloning carries inherent risks. Genetic drift, memory corruption, 
                    and cellular degradation may occur.
                  </small>
                </div>
              </div>
            </div>
            
            <div class="card mb-3 sleeve-option flash-clone-option">
              <div class="card-body">
                <div class="form-check">
                  <input 
                    class="form-check-input" 
                    type="radio" 
                    name="sleeve_choice" 
                    id="flash_clone" 
                    value="flash_clone"
                  >
                  <label class="form-check-label" for="flash_clone">
                    <h5>{{ old_character.name }} <small class="text-muted">({{ old_character.sex|title }})</small></h5>
                  </label>
                </div>
                <div class="ml-4 mt-2">
                  <div class="row">
                    <div class="col-md-3">
                      <strong>Grit:</strong> {{ old_character.grit }}
                    </div>
                    <div class="col-md-3">
                      <strong>Resonance:</strong> {{ old_character.resonance }}
                    </div>
                    <div class="col-md-3">
                      <strong>Intellect:</strong> {{ old_character.intellect }}
                    </div>
                    <div class="col-md-3">
                      <strong>Motorics:</strong> {{ old_character.motorics }}
                    </div>
                  </div>
                </div>
              </div>
            </div>
            {% endif %}
          </div>
          
          <hr />
          <div class="form-group">
            <input id="decant-button" class="form-control btn btn-outline-secondary" type="submit" value="Decant Sleeve" />
          </div>
        </form>
        
      </div>
    </div>
  </div>
</div>

<style>
/* Flash clone warning box */
.flash-clone-warning {
  background-image: repeating-linear-gradient(
    45deg,
    #e6c547 0px,
    #e6c547 20px,
    #1a1a1a 20px,
    #1a1a1a 40px
  );
  padding: 4px;
}

.flash-clone-warning > div {
  background-color: #2a2a2a;
}

.sleeve-option {
  border: 2px solid #404040;
  background-color: #2a2a2a;
  transition: all 0.2s ease;
  cursor: pointer;
}

.sleeve-option:hover {
  border-color: #5fd38d;
  background-color: #2a2a2a;
  box-shadow: 0 0 8px rgba(95, 211, 141, 0.3);
}

.sleeve-option input[type="radio"]:checked ~ label {
  font-weight: bold;
  color: #5fd38d;
}

/* Selected sleeve - jade green border with glow */
.sleeve-option:has(input[type="radio"]:checked) {
  border-color: #5fd38d;
  background-color: #2a2a2a;
  box-shadow: 0 0 12px rgba(95, 211, 141, 0.4);
}

/* Caution stripe border for flash clone */
.flash-clone-option {
  border: none;
  background-color: #2a2a2a;
  cursor: pointer;
  position: relative;
  padding: 8px;
  background-image: repeating-linear-gradient(
    45deg,
    #e6c547 0px,
    #e6c547 20px,
    #1a1a1a 20px,
    #1a1a1a 40px
  );
}

.flash-clone-option .card-body {
  background-color: #2a2a2a;
  border: none;
  transition: all 0.2s ease;
}

.flash-clone-option:hover {
  box-shadow: 0 0 8px rgba(230, 197, 71, 0.3);
}

.flash-clone-option:has(input[type="radio"]:checked) {
  box-shadow: 0 0 12px rgba(230, 197, 71, 0.4);
}

.flash-clone-option:has(input[type="radio"]:checked) input[type="radio"]:checked ~ label {
  color: #e6c547;
}

/* Decant button styling */
#decant-button {
  background-color: #2a2a2a;
  border: 2px solid #5fd38d;
  color: #5fd38d;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  transition: all 0.2s ease;
}

#decant-button:hover {
  background-color: rgba(95, 211, 141, 0.1);
  box-shadow: 0 0 12px rgba(95, 211, 141, 0.4);
  text-shadow: 0 0 8px rgba(95, 211, 141, 0.6);
}

/* Red hover for submit button when flash clone selected */
#decant-button.flash-clone-selected {
  border-color: #e6c547;
  color: #e6c547;
}

#decant-button.flash-clone-selected:hover {
  background-color: rgba(230, 197, 71, 0.1);
  box-shadow: 0 0 12px rgba(230, 197, 71, 0.4);
  text-shadow: 0 0 8px rgba(230, 197, 71, 0.6);
}
</style>

<script>
// Make entire card clickable for radio selection
document.addEventListener('DOMContentLoaded', function() {
  const sleeveCards = document.querySelectorAll('.sleeve-option');
  const decantButton = document.getElementById('decant-button');
  const flashCloneRadio = document.getElementById('flash_clone');
  const allRadios = document.querySelectorAll('input[name="sleeve_choice"]');
  
  // Update button style when selection changes
  function updateButtonStyle() {
    if (flashCloneRadio && flashCloneRadio.checked) {
      decantButton.classList.add('flash-clone-selected');
    } else {
      decantButton.classList.remove('flash-clone-selected');
    }
  }
  
  // Listen for radio button changes
  allRadios.forEach(radio => {
    radio.addEventListener('change', updateButtonStyle);
  });
  
  // Make entire card clickable for radio selection
  sleeveCards.forEach(card => {
    card.addEventListener('click', function(e) {
      // Don't trigger if clicking directly on the radio button
      if (e.target.type !== 'radio') {
        const radio = this.querySelector('input[type="radio"]');
        if (radio) {
          radio.checked = true;
          // Trigger change event to update button style
          updateButtonStyle();
        }
      }
    });
  });
  
  // Initial check
  updateButtonStyle();
});
</script>

{% endblock %}
